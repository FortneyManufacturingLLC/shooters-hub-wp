import{r as i,R as x,j as f}from"../match-finder.js";import{a as b,L as C}from"./leaflet-src-D0vtP22p.js";import"./leaflet.markercluster-src-DtY4leIU.js";import T from"./marker-icon-2x-D4k_ikNW.js";import V from"./marker-icon-C2eJqgqv.js";import P from"./marker-shadow-DU6CIJ0p.js";function U(t,e){const n=i.useRef(e);i.useEffect(function(){e!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),e!=null&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}function j(t,e,n){e.center!==n.center&&t.setLatLng(e.center),e.radius!=null&&e.radius!==n.radius&&t.setRadius(e.radius)}const Z=1;function _(t){return Object.freeze({__version:Z,map:t})}function k(t,e){return Object.freeze({...t,...e})}const L=i.createContext(null);function E(){const t=i.use(L);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function B(t){function e(n,r){const{instance:o,context:u}=t(n).current;i.useImperativeHandle(r,()=>o);const{children:c}=n;return c==null?null:x.createElement(L,{value:u},c)}return i.forwardRef(e)}function G(t){function e(n,r){const{instance:o}=t(n).current;return i.useImperativeHandle(r,()=>o),null}return i.forwardRef(e)}function N(t,e){const n=i.useRef(void 0);i.useEffect(function(){return e!=null&&t.instance.on(e),n.current=e,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,e])}function v(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function w(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function H(t,e){return e==null?function(r,o){const u=i.useRef(void 0);return u.current||(u.current=t(r,o)),u}:function(r,o){const u=i.useRef(void 0);u.current||(u.current=t(r,o));const c=i.useRef(r),{instance:l}=u.current;return i.useEffect(function(){c.current!==r&&(e(l,r,c.current),c.current=r)},[l,r,e]),u}}function I(t,e){i.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var u;(u=e.layerContainer)==null||u.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function $(t){return function(n){const r=E(),o=t(v(n,r),r);return U(r.map,n.attribution),N(o.current,n.eventHandlers),I(o.current,r),o}}function D(t,e){const n=i.useRef(void 0);i.useEffect(function(){if(e.pathOptions!==n.current){const o=e.pathOptions??{};t.instance.setStyle(o),n.current=o}},[t,e])}function q(t){return function(n){const r=E(),o=t(v(n,r),r);return N(o.current,n.eventHandlers),I(o.current,r),D(o.current,n),o}}function F(t,e){const n=H(t,e),r=q(n);return B(r)}function W(t,e){const n=H(t,e),r=$(n);return G(r)}function X(t,e,n){const{opacity:r,zIndex:o}=e;r!=null&&r!==n.opacity&&t.setOpacity(r),o!=null&&o!==n.zIndex&&t.setZIndex(o)}function R(){return E().map}function J(t){const e=R();return i.useEffect(function(){return e.on(t),function(){e.off(t)}},[e,t]),e}const K=F(function({center:e,children:n,...r},o){const u=new b.Circle(e,r);return w(u,k(o,{overlayContainer:u}))},j),Q=F(function({center:e,children:n,...r},o){const u=new b.CircleMarker(e,r);return w(u,k(o,{overlayContainer:u}))},j);function Y({bounds:t,boundsOptions:e,center:n,children:r,className:o,id:u,placeholder:c,style:l,whenReady:p,zoom:m,...s},d){const[y]=i.useState({className:o,id:u,style:l}),[a,z]=i.useState(null),M=i.useRef(void 0);i.useImperativeHandle(d,()=>(a==null?void 0:a.map)??null,[a]);const A=i.useCallback(O=>{if(O!==null&&!M.current){const h=new b.Map(O,s);M.current=h,n!=null&&m!=null?h.setView(n,m):t!=null&&h.fitBounds(t,e),p!=null&&h.whenReady(p),z(_(h))}},[]);i.useEffect(()=>()=>{a==null||a.map.remove()},[a]);const S=a?x.createElement(L,{value:a},r):c??null;return x.createElement("div",{...y,ref:A},S)}const ee=i.forwardRef(Y),te=W(function({url:e,...n},r){const o=new b.TileLayer(e,v(n,r));return w(o,r)},function(e,n,r){X(e,n,r);const{url:o}=n;o!=null&&o!==r.url&&e.setUrl(o)}),ne=[39,-98],g=t=>typeof t=="string"?t:t.src;C.Icon.Default.mergeOptions({iconRetinaUrl:g(T),iconUrl:g(V),shadowUrl:g(P)});function re({markers:t,center:e,searchCenter:n}){const r=R();return i.useEffect(()=>{if(!t.length){n&&Number.isFinite(n.lat)&&Number.isFinite(n.lng)?r.setView([n.lat,n.lng],8):r.setView(e,4);return}if(t.length===1){r.setView([t[0].lat,t[0].lng],9);return}const o=t.map(u=>[u.lat,u.lng]);r.fitBounds(o,{padding:[24,24],maxZoom:9})},[r,t,e,n]),null}function oe({markers:t}){const e=R();return i.useEffect(()=>{const n=c=>c.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),r=c=>{const l=c.trim();return l&&(l.startsWith("/")||/^https?:\/\//i.test(l))?l:null},o=C.markerClusterGroup,u=typeof o=="function"?o({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0}):C.layerGroup();return t.forEach(c=>{const l=C.marker([c.lat,c.lng]),p=n(c.title||"Location"),m=n(c.subtitle||""),s=r(c.href||""),d=['<div style="min-width:180px">',`<div style="font-weight:600;margin-bottom:2px">${p}</div>`];m&&d.push(`<div style="font-size:12px;margin-bottom:4px;color:#475569">${m}</div>`),s&&d.push(`<a href="${s}" style="color:#0c4a6e;text-decoration:underline">View details →</a>`),d.push("</div>"),l.bindPopup(d.join("")),u.addLayer(l)}),e.addLayer(u),()=>{e.removeLayer(u)}},[e,t]),null}function ue({enabled:t,onSearchCenterChange:e}){return J({click(n){if(!t||!e)return;const{lat:r,lng:o}=n.latlng;!Number.isFinite(r)||!Number.isFinite(o)||e({lat:r,lng:o})}}),null}function me({points:t,searchCenter:e,searchRadiusMi:n,onSearchCenterChange:r,searchCenterInteractive:o=!1}){const u=i.useMemo(()=>t.filter(s=>Number.isFinite(s.lat)&&Number.isFinite(s.lng)),[t]),l=!!(e&&Number.isFinite(e.lat)&&Number.isFinite(e.lng))&&e?[e.lat,e.lng]:null,p=i.useMemo(()=>(Number.isFinite(n)?Math.max(0,Number(n)):100)*1609.34,[n]),m=i.useMemo(()=>{if(!u.length)return ne;const s=u.reduce((y,a)=>y+a.lat,0)/u.length,d=u.reduce((y,a)=>y+a.lng,0)/u.length;return[s,d]},[u]);return f.jsx("div",{className:"relative z-0 h-full min-h-[420px] w-full",children:f.jsxs(ee,{center:m,zoom:u.length>6?4:5,minZoom:3,maxZoom:12,zoomControl:!1,attributionControl:!0,style:{height:"100%",width:"100%"},preferCanvas:!0,children:[f.jsx(re,{markers:u,center:m,searchCenter:e}),f.jsx(ue,{enabled:o,onSearchCenterChange:r}),f.jsx(te,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}),l?f.jsxs(f.Fragment,{children:[f.jsx(K,{center:l,radius:p,pathOptions:{color:"#f59e0b",weight:1.5,fillColor:"#f59e0b",fillOpacity:.14}}),f.jsx(Q,{center:l,radius:6,pathOptions:{color:"#fff7ed",weight:1.5,fillColor:"#f59e0b",fillOpacity:.95}})]}):null,f.jsx(oe,{markers:u})]})})}export{me as default};
